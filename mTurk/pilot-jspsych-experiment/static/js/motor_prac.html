<script src="static/js/utils.js"></script>

<script>
/* Always track the mouse */
var mouseX, mouseY;
$(function() {
  	$(document).bind('mousemove.overall', function(e) {
    	mouseX = e.pageX;
    	mouseY = e.pageY;
  	});
});

/* Handle continuous report for either bar or grating response by using a single
   image with jQuery rotation based on mouse coordinate angle */
function ShowContinuousReport(trialStruct) {
  	var angleDeg = 0;
  	var randAdj = 360 * Math.random();
  	// console.log(randAdj);
  	var curError = 360;
  	var startTime = new Date();

  	if (!motorPrac) {
  		ReportSelection(trialStruct);
  	}

  	setTimeout(function() {
  		document.body.style.cursor = 'auto';
  		$("#continuousStimulus").show();
  		$(document).bind('keyup.curTrial', 'space', function(e) {
			var answer = wrap(360 - (angleDeg + randAdj));
			trialStruct.reportedAngle = Math.round(answer);
	    	trialStruct.rt = (new Date()) - startTime;
		    $(document).unbind('keyup.curTrial');
		    $(document).unbind('mousemove.curTrial');
		    
		    var difference = Math.abs(trialStruct.items[trialStruct.targetIndex] - trialStruct.reportedAngle);
		    var oriDiff = Math.abs((difference%180)-90);
		    var percentCorrect = (oriDiff/90) * 100;
		    console.log(percentCorrect);

		    $("#continuousStimulus").hide();
		    $("#continuousReport").hide();
		    if (motorPrac) {
		    	$("#motorPrac").hide();
		    	mPracPerf.push(percentCorrect);
		    	mPracNext();
		    } else {
		    	Perf.push(percentCorrect);
		    	FeedbackReport(trialStruct);
		    }
	     	
		});
  	}, reportShowTime);

	$(document).bind('mousemove.curTrial', function(e) {
		var initOffset = $('#continuousReport').offset(); 
	   	var relX = e.pageX - centerX;
	  	var relY = e.pageY - centerY;
		var curAngle = Math.atan2(relY,relX);
		
		angleDeg = (curAngle / Math.PI * 180.0);
	    angleDeg = (angleDeg < 0) ? angleDeg+360:angleDeg;
	    
	    $("#continuousStimulus").css("top", ($("#continuousReport").height() - itemDim)/2);
	    $("#continuousStimulus").css("left", ($("#continuousReport").width() - itemDim)/2);
		$("#gaborCont").rotate(angleDeg + randAdj);
	});

	$("#continuousReport").show();
	e = $.Event('mousemove');
	e.pageX = mouseX;
	e.pageY = mouseY;
	$(document).trigger(e);
}
</script>

<noscript>
	<h1>Warning: Javascript seems to be disabled</h1>
	<p>This website requires that Javascript be enabled on your browser.</p>
	<p>Instructions for enabling Javascript in your browser can be found 
	<a href="http://support.google.com/bin/answer.py?hl=en&answer=23852">here</a><p>
</noscript>

<!-- Structure for continuous report after the trial: -->
<div id="continuousReport">
	<canvas id="fixationCont" class="fixation"> Your browser does not support the HTML5 canvas tag.</canvas>
	<div id="continuousStimulus">
		<img id="gaborCont" src="static/images/gaborCont.png" alt="response" class="gabor" width="100">
	</div>
	<div id="targetSelect">
		<canvas id="circSelect" width="200" height="200"> Your browser does not support the HTML5 canvas tag.</canvas>
	</div>
	<!-- <div id="feedback">
	Congratulations! You have completed of the experiment.
	Average Accuracy:
	Bonus points:
	</div> -->
	<div id="motorPrac" class="array">
		<img src="static/images/gaborCont.png" class="gabor" width="100">
	</div>
</div>